## Normalization, 정규화
정규화는 이상현상이 있는 relation을 분해하여 이상현상을 없애는 과정이다. 이상현상이 존재하는 relation을 분해하여 여러 개의 relation을 생성하게 된다. 이를 단계별로 구분하여 정규형이 높아질수록 이상현상은 줄어들게 된다.

#### 정규화의 장점
- 데이터베이스 변경 시 이상 현상(Anomaly)을 제거할 수 있다.
- 정규화된 데이터베이스 구조에서는 새로운 데이터 형의 추가로 인한 확장 시, 그 구조를 변경하지 않아도 되거나 일부만 변경해도 된다.
- 데이터베이스와 연동된 응용 프로그램에 최소한의 영향만을 미치게 되어 응용프로그램의 생명을 연장시킨다.

#### 정규화의 단점
- relation의 분해로 인해 relation 간에 JOIN 연산이 많아진다.
- 질의에 대한 응답 시간이 느려질 수 있다. 데이터의 중복 속성을 제거하고 결정자에 의해 동일한 의미의 일반 속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최대화되는 효과가 있다.
- JOIN이 많이 발생하여 성능 저하가 나타나면 반정규화(de-normalizaion)를 적용해야 될 수도 있다.

-----------------------
##### 이상현상
- 삽입 이상(Insertion Anomaly) : 튜플 삽입 시 특정 속성에 해당하는 값이 없어 NULL을 입력해야 하는 현상
- 삭제 이상(Deletion Anomaly) : 튜플 삭제 시 같이 저장된 다른 정보까지 연쇄적으로 삭제되는 현상
- 갱신 이상(Update Anomaly) : 튜플 갱신 시 중복된 데이터의 일부만 갱신되어 일어나는 데이터 불일치 현상

##### 함수 종속성(FD, Functional Dependency)
- 함수 종속성은 어떤 속성 A의 값을 알면 다른 속성 B의 값이 유일하게 정해지는 관계를 종속성이라고 한다.
- A->B로 표기하며 A를 B의 결정자(Determinant)라고 한다.
- A->B이면 A는 B를 결정한다(Determine)고 하고, B는 A에 종속한다(Dependent)라고 한다.

##### 함수 종속성 다이어그램
![image](https://user-images.githubusercontent.com/118147296/220065519-cf835c35-9630-4d58-87f4-c36f7a75d089.png)

출처. 쉽게 배우는 오라클로 배우는 데이터베이스 개론과 실습 ppt

- relation속성 : 직사각형
- 속성 간의 함수 종속성 : 화살표
- 복합 속성 : 직사각형으로 묶음

-----------------------

> 제1 정규형(1NF)
제1 정규형은 다음과 같은 규칙들을 만족해야 한다.
1. 각 컬럼이 하나의 속성만을 가져야 한다.
2. 하나의 컬럼은 같은 종류나 타입(type)의 값을 가져야 한다.
3. 각 컬럼이 유일한(unique) 이름을 가져야 한다.
4. 칼럼의 순서가 상관없어야 한다.

![image](https://user-images.githubusercontent.com/118147296/220092344-45ddab02-5706-4a7b-8930-cb19fc6d646c.png)

1. 각 컬럼이 하나의 값(속성)만을 가져야 한다. -> 불만족! 하나의 칼럼(과목)에 두 개의 값을 가짐
2. 하나의 컬럼은 같은 종류나 타입(type)의 값을 가져야 한다. -> 만족
3. 각 컬럼이 유일한(unique) 이름을 가져야 한다. -> 만족
4. 칼럼의 순서가 상관없어야 한다. -> 만족

>> 1번 규칙을 불만족하므로 이를 고치기 위해서는 아래와 같이 분해하면 된다.
![image](https://user-images.githubusercontent.com/118147296/220093174-d89501e8-351b-443b-a39c-83447224c284.png)

위와 같이 각 칼럼이 원자 값을 갖도록 테이블을 분해하면 1 정규형을 만족하게 바꿀 수 있다.


> 제2 정규형
제2 정규형은 다음과 같은 규칙을 만족해야 한다.
1. 1정규형을 만족해야 한다.
2. 모든 컬럼이 부분적 종속(Patial Dependency)이 없어야 한다. == 모든 칼럼이 완전 함수 종속을 만족해야 한다.

부분적 종속이란 기본키 중에 특정 컬렘에만 종속되는 것이다.
완전 함수 종속이란 기본키의 부분집합이 결정자가 되어선 안된다는 것이다.

![image](https://user-images.githubusercontent.com/118147296/220093989-cfbcb710-1617-43c1-a011-530fedc36c38.png)


위와 같은 테이블과 FD 다이어그램을 보면, 성적의 특정 값을 알기 위해서는 학생번호와 과목이 있어야 한다.

하지만 특정 과목의 지도교수는 과목명만 알면 지도교수가 누군지 알 수 있다.

위 테이블에서 기본키는(학생 번호, 과목)으로 복합키이다. 그런데 이때 지도교수 칼럼은(학생 번호, 과목)에 종속되지 않고 (과목)에만 종속되는 부분적 종속이다.

따라서 제2 정규화를 만족하지 않으므로 아래와 같이 분해해야 한다.
![image](https://user-images.githubusercontent.com/118147296/220094335-bbd52d95-7f19-4bab-8210-fa00dab5c9e4.png)

위와 같이 분해를 하게 되면 제2 정규형을 만족한다.

> 제3 정규형(3NF)
제3 정규형은 다음과 같은 규칙을 만족해야 한다.
1. 2정규형을 만족해야 한다.
2. 기본키를 제외한 속성들 간의 이행 종속성(Transitive Dependency)이 없어야 한다.

이행 종속성이란 A->B, B->C 일 때, A -> C가 성립하면 이행 종속이라고 한다.
![image](https://user-images.githubusercontent.com/118147296/220094711-3d0cabe2-a8f1-46b1-8cad-74b151d96ab0.png)

ID를 알면 등급을 알 수 있고, 등급을 알면 할인율을 알 수 있다. 따라서 ID를 알면 할인율을 알 수 있다. 따라서 이행 종속성이 존재하므로 제3 정규형을 만족하지 않는다.

3정규형을 만족시키기 위해서는 아래와 같이 분해하면 된다.
![image](https://user-images.githubusercontent.com/118147296/220094982-2dd79cb1-328b-4714-86d1-a1feceb862e9.png)

위와 같이 분해하면 제3 정규형을 만족한다.

> BCNF (Boyce-Codd Normal Form)
BCNF는 제3 정규형을 좀 더 강화한 버전으로 다음과 같은 규칙을 만족해야 한다.
1. 3정규형을 만족해야 한다.
2. 모든 결정자가 후보키 집합에 속해야 한다.

모든 결정자가 후보키 집합에 속해야 한다는 뜻은, 후보키 집합에 없는 칼럼이 결정자가 되어서는 안된다는 뜻이다.
![image](https://user-images.githubusercontent.com/118147296/220095280-d16e407d-66ee-4d13-8e14-9e9bf8473ac2.png)

위와 같은 테이블을 보면 '학생번호/과목'이 기본키로 지도교수를 알 수 있다. 하지만 같은 과목을 다른 교수가 가르칠 수도 있어서 과목 -> 지도교수 종속은 성립하지 않는다.

하지만 지도교수가 어떤 과목을 가르치는지는 알 수 있으므로 지도교수 -> 과목 종속이 성립한다.

이처럼 후보키 집합이 아닌 칼럽이 결정자가 되어버린 상황을 BCNF를 만족하지 않는다고 한다. (참고로 위 테이블은 제3 정규형까지는 만족하는 테이블이다.) BCNF를 만족하기 위해서는 아래와 같이 분해하면 된다.
![image](https://user-images.githubusercontent.com/118147296/220095801-63327943-6be8-4b7b-baf9-d4377a23df8c.png)


